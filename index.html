<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Sean Wang Resume!</title>
    <style>
      :root {
        --xp-blue1: #95b2e8; /* titlebar top */
        --xp-blue2: #7a96df; /* titlebar bottom */
        --xp-green: #29a019; /* start btn */
        --xp-green-dark: #1b7b10;
        --xp-task: #2662df; /* taskbar */
        --xp-task-top: #377fe3; /* light highlight */
        --window: #f0f0f0;
        --shadow: rgba(0, 0, 0, 0.45);
        --desk-shadow: rgba(0, 0, 0, 0.25);
        --accent: #2e7cff;
      }

      * {
        box-sizing: border-box;
      }
      html, body {
        height: 100dvh;
        overflow: hidden;
        margin: 0;
        font-family: Tahoma, Segoe UI, Verdana, sans-serif;
        color: #111;
        padding-bottom: env(safe-area-inset-bottom, 0);
      }

      body {
        /* Wallpaper: swap for Bliss if desired */
        background: url("r6g38aXSaQWtd1KxwJbQ-Fs5jtSVDxX3wtLHJEdqixw.jpg") no-repeat center center fixed;
        background-size: cover;
      }

      /* Desktop */
      .desktop {
        position: absolute;
        height: 100dvh;
        inset: 0;
        display: grid;
        grid-template-rows: 1fr 40px;
      }
      #desktop {
        position: relative;
        height: 100dvh;
        overflow: hidden;
      }
      .icons {
        position: relative;
        height: calc(100vh - 40px);
        padding: 12px;
        user-select: none;
      }

      /* Icons: absolute so we can drag anywhere; we'll snap to a 96px grid */
      .desktop-icon {
        position: absolute;
        width: 96px;
        height: 96px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        border-radius: 6px;
        cursor: default;
      }
      .desktop-icon:focus-visible {
        outline: 2px solid #fff;
      }
      .desktop-icon.selected {
        background: rgba(46, 124, 255, 0.25);
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.25) inset;
      }
      .desktop-icon img {
        width: 40px;
        height: 40px;
        object-fit: contain;
        image-rendering: pixelated;
        filter: drop-shadow(0 2px 1px rgba(0, 0, 0, 0.45));
      }
      .file-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 10px;
        padding: 10px;
        background: #fff;
      }
      .file-item {
        display: flex; gap: 8px; align-items: center;
        padding: 8px; border: 1px solid #d9d9d9; border-radius: 6px;
        background: linear-gradient(#fff, #f5f7ff);
        cursor: default;
        user-select: none;
      }
      .file-item:hover { border-color: #2e7cff; box-shadow: 0 0 0 1px #2e7cff inset; }
      .file-item.selected { background: #cfe2ff; border-color: #2e7cff; }
      .file-item .ficon { width: 24px; height: 24px; image-rendering: pixelated; object-fit: contain; }
      .file-item .meta { display: grid; }
      .file-item .name { font-weight: 700; }
      .file-item .sub { font-size: 12px; opacity: .75; }

      .icon-label {
        max-width: 80px;
        text-align: center;
        color: #fff;
        text-shadow: 0 2px 2px var(--desk-shadow);
        font-size: 12px;
        line-height: 1.1;
      }

      /* Taskbar */
      .taskbar {
        position: fixed;
        bottom: env(safe-area-inset-bottom, 0);  /* shift up if needed */
        height: 40px;
        width: 100vw;
        background: var(--xp-task);
        z-index: 10000;
        display: flex;
        align-items: center;
        padding: 0 8px;
        box-shadow: inset 0 1px 0 var(--xp-task-top);
      }

      /* Optional: even crisper top/bottom “non‑blended” bands */
      .taskbar::before,
      .taskbar::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        height: 2px;
        pointer-events: none;
      }
      .taskbar::before {
        top: 0;
        background: var(--xp-task-top);
      } /* top thin light */
      .taskbar::after {
        bottom: 0;
        background: #143c9b;
      } /* bottom thin dark */
      .start {
        position: relative; /* for highlight/gloss layers */
        display: inline-flex;
        align-items: center;
        gap: 8px;

        /* XP size: smaller than taskbar with breathing room */
        height: 40px; /* taskbar is 40px in your file */
        padding: 0 20px 0 20px;
        margin: 0 5px 0 5px;
        margin-left: 0px; /* top/bottom space so it floats inside the bar */
        margin-right: 2px;

        /* XP pill: big curve on the left, small on the right */
        border-radius: 0px 22px 22px 0px;

        color: #fff;
        font-weight: 700;
        font-size: 20px;
        font-style: italic;
        text-transform: lowercase; /* "start" */
        letter-spacing: 0.2px;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.45);

        /* XP green bevel: light → base */
        background: linear-gradient(#46db48, var(--xp-green));
        border: 1px solid var(--xp-green-dark);

        /* thin non‑blended bands for XP look */
        box-shadow: inset 0 1px 0 #7af477,
          /* 1px top inner highlight */ inset 0 -1px 0 #0d5d0b,
          /* 1px bottom inner shadow */ 0 2px 2px rgba(0, 0, 0, 0.35); /* outer drop */
      }
      .start.win-logo {
        width: 20px;
        height: 20px;
        image-rendering: pixelated;
        object-fit: contain;
      }

      /* 2px hard highlight strip at the very top (XP cap) */
      .start::before {
        content: "";
        position: absolute;
        left: 0px;
        right: 0px;
        top: 2px;
        height: 2px;
        right: 11px;
        background: #bdf7bb;
        border-radius: 8px 18px 0 0;
        pointer-events: none;
      }

      /* subtle glossy dome on the top half */
      .start::after {
        content: "";
        position: absolute;
        left: 8px;
        right: 8px;
        top: 3px;
        height: 56%;
        left: 0px;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.45),
          rgba(255, 255, 255, 0.08)
        );
        border-radius: 0px 20px 20px 0px;
        pointer-events: none;
      }

      /* Hover & pressed (keep your current feel but tuned for the new size) */
      .start:hover {
        background: linear-gradient(#5fe65f, #23b31e);
        box-shadow: inset 0 1px 0 #a2f9a1, inset 0 -1px 0 #0e6610,
          0 2px 3px rgba(0, 0, 0, 0.35);
      }

      .start:active {
        background: linear-gradient(var(--xp-green), #46db48); /* flip bevel */
        box-shadow: inset 0 1px 0 #0e6610, inset 0 -1px 0 #a2f9a1,
          0 1px 1px rgba(0, 0, 0, 0.35);
        transform: translateY(1px);
      }
      .win-logo {
        width: 30px;
        height: 30px;
      }

      .quick-launch {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 0 6px;
        padding-left: 6px;
      }

      .ql {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        height: 30px;
        width: 30px;
        padding: 2px;
        border: none;
        background: transparent; /* no white boxes */
        border-radius: 4px;
        cursor: pointer;
        transition: all 160ms ease; /* smooth expand */
      }
      .ql img {
        width: 24px;
        height: 24px;
        object-fit: contain;
        image-rendering: pixelated;
      }
      .ql .ql-label {
        display: none; /* hidden until open */
        font-size: 12px;
        color: #fff;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.45);
        white-space: nowrap;
      }
      .ql.open {
        padding: 2px 10px;
        min-width: 120px;
        background: linear-gradient(#2c64c6, #1f4db0); /* XP task blue */
        border: 1px solid #123b7c;
        box-shadow: inset 0 1px 0 #5f9df9,
          /* top highlight band */ inset 0 -1px 0 #1d3d8c,
          /* bottom band */ 0 0 10px rgba(66, 130, 255, 0.55); /* outer glow */
      }
      .ql.open .ql-label {
        display: inline;
      }

      /* Focused/active window: brighter glow */
      .ql.open.active {
        box-shadow: inset 0 1px 0 #8dbffd, inset 0 -1px 0 #18387f,
          0 0 14px rgba(100, 160, 255, 0.85);
      }

      /* Optional: dim when window is minimized/inactive */
      .ql.open.inactive {
        filter: saturate(0.8) brightness(0.95);
        box-shadow: inset 0 1px 0 #5f9df9, inset 0 -1px 0 #1d3d8c;
      }

      .ql:hover {
        background: rgba(255, 255, 255, 0.12);
        border-radius: 4px;
      }
      .ql:active {
        transform: translateY(1px);
      }
      /* Base sticky */
      .sticky {
        position: absolute;
        width: 300px;
        min-height: 140px;
        border: 1px solid rgba(0,0,0,.25);
        border-radius: 2px;
        box-shadow:
          0 10px 24px rgba(0,0,0,.25),
          inset 0 1px 0 rgba(255,255,255,.6);
        overflow: hidden;
        user-select: none;
      }

      /* Title bars (drag handle) */
      .sticky .sticky-header {
        padding: 6px 10px;
        font: 700 13px Tahoma, Segoe UI, Verdana, sans-serif;
        color: #1b1b1b;
        text-shadow: 0 1px 0 rgba(255,255,255,.5);
        border-bottom: 1px solid rgba(0,0,0,.15);
        cursor: move;                /* drag from here */
      }

      /* Bodies (editable) */
      .sticky .sticky-body {
        padding: 12px 16px;
        white-space: normal;              /* was pre-wrap; avoids weird breaks */
        line-height: 1.35;
        font-size: 14px;
      }

      .sticky .sticky-body h3,
      .sticky .sticky-body h4 {
        margin: 4px 0 2px;                /* smaller heading margins */
        font-size: 15px;                  /* keep headings only slightly bigger */
        font-weight: 700;
      }

      .sticky .sticky-body p {
        margin: 6px 0;                    /* tighter paragraphs */
      }

      .sticky .sticky-body i {
        display: block;                   /* put the date on its own line nicely */
        margin: 2px 0 6px;
        font-style: italic;
        opacity: .9;
      }

      /* Colors */
      #note-edu { background: #fff29d; }            /* classic sticky yellow */
      #note-edu .sticky-header { background: #ffe97a; }

      #note-comp { background: #dff8c6; }           /* light classic green */
      #note-comp .sticky-header { background: #c7f0ab; }

      /* Focus (bring to front look) */
      .sticky.active {
        box-shadow:
          0 12px 28px rgba(0,0,0,.3),
          0 0 0 2px rgba(46,124,255,.35),
          inset 0 1px 0 rgba(255,255,255,.7);
      }

      .tasks {
        display: flex;
        align-items: center;
        gap: 6px;
        overflow-x: auto;
        flex: 1;
        padding: 0 6px;
      }
      .task {
        white-space: nowrap;
        padding: 6px 12px;
        background: linear-gradient(#fdfdfd, #e6e6e6);
        color: #111;
        border-radius: 4px;
        border: 1px solid #c6c6c6;
        box-shadow: 0 1px 0 #fff inset;
        cursor: pointer;
      }
      .task.active {
        outline: 2px solid var(--accent);
      }

      .tray {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 0 6px;
        border-left: 1px solid #cfcfcf;
      }
      .clock {
        font-size: 12px;
        color: #333;
      }

      /* Windows */
      .window {
        position: absolute;
        min-width: 360px;
        min-height: 240px;
        max-width: min(880px, 92vw);
        max-height: min(76vh, 92vh);
        background: var(--window);
        border: 1px solid #003;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 8px 10px 0 rgba(0, 0, 0, 0.25),
          0 0 0 1px rgba(0, 0, 0, 0.35) inset;
        display: grid;
        grid-template-rows: 28px 1fr 24px;
      }
      .window.inactive {
        opacity: 0.98;
        filter: saturate(0.95);
      }

      .titlebar {
        position: relative;
        height: 28px;
        background: var(--xp-blue2); /* solid base */
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 4px 0 8px;
        cursor: move;
        box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.15);
      }

      /* 2px highlight at top and 2px shadow at bottom */
      .titlebar::before,
      .titlebar::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        height: 2px;
        pointer-events: none;
      }

      .titlebar::before {
        top: 0;
        background: var(--xp-blue1); /* top highlight band */
      }

      .titlebar::after {
        bottom: 0;
        background: #5c76bf; /* bottom shadow (manually tuned) */
      }

      .title-left {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .title-left .mini-icon {
        width: 16px;
        height: 16px;
      }
      .title-text {
        font-weight: 700;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.4);
      }

      .title-controls {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .ctl {
        width: 22px;
        height: 20px;
        display: grid;
        place-items: center;
        border: 1px solid #5c76bf; /* XP-style deep blue border */
        border-radius: 3px;
        background: linear-gradient(
          #5f86eb,
          #7a96df
        ); /* top highlight blue → base */
        cursor: pointer;
        box-shadow: inset 0 1px 0 #ffffff,
          /* top inner highlight */ inset 0 -1px 0 #5673c1; /* bottom inner shadow */
      }
      .ctl:hover {
        background: linear-gradient(#a4c6f4, #88a9e8); /* brighter on hover */
      }

      .ctl:active {
        background: linear-gradient(
          #7a96df,
          var(--xp-blue1)
        ); /* reverse bevel on press */
        box-shadow: inset 0 1px 0 #5673c1, inset 0 -1px 0 #ffffff;
      }
      .ctl.close {
        background: linear-gradient(#ff7878, #db2f2f);
        border-color: #7a0a0a;
      }
      .ctl.close:hover {
        background: linear-gradient(
          #ff9999,
          #e64545
        ); /* lighter red gradient */
        border-color: #a00000;
      }

      /* Active = pressed state (bevel reversed) */
      .ctl.close:active {
        background: linear-gradient(#db2f2f, #ff7878); /* reverse bevel */
        box-shadow: inset 0 1px 0 #a00000, inset 0 -1px 0 #ffbdbd;
      }
      .ctl svg {
        width: 12px;
        height: 12px;
        fill: #111;
      }

      .content {
        background: #fff;
        padding: 12px;
        overflow: auto;
      }
      .content h2 {
        margin: 0 0 8px;
      }
      .content p {
        margin: 0 0 10px;
      }
      .snake-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        padding: 12px;
      }
      .snake-canvas {
        width: 320px;
        height: 320px;
        background: #041806;
        border: 1px solid #123b7c;
        border-radius: 4px;
        image-rendering: pixelated;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
      }
      .snake-hud {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        width: 100%;
        max-width: 320px;
        font-size: 14px;
        font-weight: 700;
        color: #123b7c;
      }
      .snake-score {
        color: #1b7b10;
      }
      .snake-btn {
        padding: 6px 14px;
        border-radius: 4px;
        border: 1px solid #123b7c;
        background: linear-gradient(#5f86eb, #2c64c6);
        color: #fff;
        font-weight: 700;
        cursor: pointer;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.45);
        box-shadow: inset 0 1px 0 #8dbffd, inset 0 -1px 0 #1b3f8b;
      }
      .snake-btn:hover {
        filter: brightness(1.05);
      }
      .snake-btn:active {
        box-shadow: inset 0 1px 0 #1b3f8b, inset 0 -1px 0 #8dbffd;
        transform: translateY(1px);
      }
      .snake-help {
        font-size: 12px;
        opacity: 0.75;
        text-align: center;
        margin: 0;
        max-width: 320px;
      }
      .tetris-content {
        display: flex;
        gap: 16px;
        align-items: flex-start;
        padding: 12px;
      }
      .tetris-main {
        position: relative;
      }
      .tetris-canvas {
        width: 240px;
        height: 480px;
        background: #0b132b;
        border: 1px solid #123b7c;
        border-radius: 4px;
        image-rendering: pixelated;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
      }
      .tetris-sidebar {
        display: flex;
        flex-direction: column;
        gap: 12px;
        min-width: 160px;
        font-size: 14px;
        color: #123b7c;
      }
      .tetris-stat {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 12px;
        border: 1px solid #cbd5f0;
        border-radius: 4px;
        background: #f0f4ff;
        font-weight: 600;
      }
      .tetris-stat strong {
        font-size: 16px;
        color: #1b7b10;
      }
      .tetris-next {
        width: 120px;
        height: 120px;
        align-self: center;
        background: #0b132b;
        border: 1px solid #123b7c;
        border-radius: 4px;
        image-rendering: pixelated;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08);
      }
      .tetris-btn {
        padding: 6px 14px;
        border-radius: 4px;
        border: 1px solid #123b7c;
        background: linear-gradient(#58b3f6, #1c72d4);
        color: #fff;
        font-weight: 700;
        cursor: pointer;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.45);
        box-shadow: inset 0 1px 0 #9ad1ff, inset 0 -1px 0 #144c99;
      }
      .tetris-btn:hover {
        filter: brightness(1.05);
      }
      .tetris-btn:active {
        box-shadow: inset 0 1px 0 #144c99, inset 0 -1px 0 #9ad1ff;
        transform: translateY(1px);
      }
      .tetris-help {
        font-size: 12px;
        opacity: 0.75;
        margin: 0;
        line-height: 1.5;
      }
      .project-subhead {
        margin: 10px 0 6px;
        font-size: 15px;
        font-weight: 700;
      }
      .project-actions {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 12px;
      }
      .project-repo-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px 22px;
        border-radius: 6px;
        border: 1px solid #1f0a3f;
        background: linear-gradient(180deg, #2d0a59 0%, #230845 55%, #17042d 100%);
        color: #efe9ff;
        font-weight: 700;
        text-decoration: none;
        box-shadow:
          inset 0 1px 0 rgba(255, 255, 255, 0.12),
          inset 0 -1px 0 rgba(0, 0, 0, 0.35),
          0 2px 4px rgba(23, 4, 45, 0.45);
        transition: background 160ms ease, transform 160ms ease;
      }
      .project-repo-btn:hover {
        background: linear-gradient(180deg, #3a0e70 0%, #2a0a52 60%, #1c0737 100%);
      }
      .project-repo-btn:active {
        background: linear-gradient(180deg, #2a0a52 0%, #1b0533 100%);
        transform: translateY(1px);
      }
      .wmp-player {
        display: flex;
        min-height: 320px;
        background: linear-gradient(180deg, #f7f9ff 0%, #e4e9f5 100%);
        border: 1px solid #8c9ec2;
        border-radius: 4px;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.65), inset 0 -1px 0 rgba(0, 0, 0, 0.12);
        overflow: hidden;
      }
      .wmp-sidebar {
        width: 180px;
        background: linear-gradient(180deg, #dfe7f8 0%, #c6d1eb 100%);
        border-right: 1px solid rgba(122, 138, 176, 0.6);
        display: flex;
        flex-direction: column;
      }
      .wmp-sidebar h4 {
        margin: 0;
        padding: 12px 16px;
        font-size: 14px;
        font-weight: 700;
        color: #1a2c56;
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.6);
        border-bottom: 1px solid rgba(124, 146, 196, 0.55);
      }
      .wmp-tracklist {
        flex: 1;
        overflow-y: auto;
        padding: 0;
        margin: 0;
        list-style: none;
      }
      .wmp-track {
        padding: 10px 14px;
        cursor: pointer;
        display: grid;
        gap: 2px;
        background: transparent;
        transition: background 120ms ease, color 120ms ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.35);
      }
      .wmp-track:hover {
        background: rgba(126, 159, 230, 0.25);
      }
      .wmp-track.active {
        background: rgba(126, 159, 230, 0.45);
        box-shadow: inset 0 0 0 1px rgba(108, 140, 214, 0.65);
      }
      .wmp-track-title {
        font-weight: 600;
        color: #1b2b54;
        font-size: 12px;
      }
      .wmp-track-meta {
        font-size: 10px;
        opacity: 0.7;
        color: #4f6595;
      }
      .wmp-main {
        flex: 1;
        min-height: 0; /* allow scrolling inside flex container */
        overflow-y: auto;
        background: linear-gradient(180deg, #f8fbff 0%, #edf2fb 100%);
        display: flex;
        flex-direction: column;
        gap: 18px;
        padding: 18px 18px 24px;
        box-sizing: border-box;
      }
      .wmp-display {
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 0;
      }
      .wmp-display img {
        width: 200px;
        height: 200px;
        border-radius: 10px;
        border: 1px solid rgba(0, 0, 0, 0.12);
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
        object-fit: cover;
      }
      .wmp-display.paused::after {
        content: 'Paused';
        position: absolute;
        bottom: 18px;
        left: 50%;
        transform: translateX(-50%);
        padding: 4px 12px;
        border-radius: 999px;
        background: rgba(32, 51, 92, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.45);
        color: #f1f4ff;
        font-size: 12px;
        letter-spacing: 0.4px;
        text-transform: uppercase;
      }
      .wmp-display iframe {
        width: 100%;
        max-width: 480px;
        aspect-ratio: 16 / 9;
        border: 1px solid rgba(0, 0, 0, 0.12);
        border-radius: 8px;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      }
      .wmp-nowplaying {
        padding: 0;
        color: #1b2b54;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .wmp-now-blurb {
        font-size: 13px;
        line-height: 1.45;
        color: #1f2f56;
        margin: 0;
        padding: 0 2px 18px 0;
        }
      .wmp-main::-webkit-scrollbar {
        width: 10px;
      }
      .wmp-main::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.08);
        border-radius: 999px;
      }
      .wmp-main::-webkit-scrollbar-thumb {
        background: rgba(104, 135, 198, 0.55);
        border-radius: 999px;
      }
      .wmp-now-blurb::-webkit-scrollbar {
        width: 8px;
      }
      .wmp-now-blurb::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.08);
        border-radius: 999px;
      }
      .wmp-now-blurb::-webkit-scrollbar-thumb {
        background: rgba(104, 135, 198, 0.6);
        border-radius: 999px;
      }
      .wmp-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 14px;
        margin-bottom: 12px;
      }
      .wmp-btn {
        width: 52px;
        height: 52px;
        border-radius: 50%;
        border: 1px solid #4e7fd9;
        background: linear-gradient(180deg, #85abff 0%, #4f7fe5 60%, #2d59b9 100%);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.55), inset 0 -2px 0 rgba(0, 0, 0, 0.25), 0 3px 6px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 120ms ease, box-shadow 120ms ease;
      }
      .wmp-btn svg {
        width: 20px;
        height: 20px;
        fill: #f4f6ff;
      }
      .wmp-btn:hover {
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.45), inset 0 -2px 0 rgba(0, 0, 0, 0.45), 0 2px 8px rgba(80, 125, 255, 0.4);
      }
      .wmp-btn:active {
        transform: translateY(1px);
        box-shadow: inset 0 1px 0 rgba(0, 0, 0, 0.35), inset 0 -1px 0 rgba(255, 255, 255, 0.2);
      }
      .wmp-btn-play {
        width: 64px;
        height: 64px;
        border: 1px solid #c1c9d7;
        background:
          radial-gradient(circle at 32% 32%, rgba(255, 255, 255, 0.96) 0%, rgba(233, 236, 244, 0.92) 55%, rgba(208, 214, 227, 0.95) 100%),
          linear-gradient(180deg, rgba(255, 255, 255, 0.82) 0%, rgba(213, 219, 232, 0.9) 55%, rgba(185, 194, 210, 0.95) 100%);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.88), inset 0 -3px 0 rgba(0, 0, 0, 0.22), 0 3px 10px rgba(0, 0, 0, 0.24);
      }
      .wmp-btn-play svg {
        fill: #23335d;
      }
      .status {
        height: 24px;
        background: linear-gradient(#efefef, #e4e4e4);
        border-top: 1px solid #c9c9c9;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 0 8px;
        font-size: 12px;
        color: #333;
      }

      .hidden {
        display: none !important;
      }
      /* XP boot overlay */

      .boot-screen {
        position: fixed;
        inset: 0;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 24px;
        padding: 40px 20px;
        color: #fff;
        font-family: "Segoe UI", Tahoma, Verdana, sans-serif;
        background: radial-gradient(circle at 30% 30%, #1f3f9e 0%, #0a1a4f 55%, #030913 100%);
        text-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
        overflow: hidden;
      }
      .boot-screen::before {
        content: "";
        position: absolute;
        inset: -45%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.12), transparent 60%);
        opacity: 0.5;
        pointer-events: none;
      }
      .boot-screen::after {
        content: "";
        position: absolute;
        inset: 0;
        background:
          linear-gradient(160deg, rgba(255, 255, 255, 0.08) 0%, transparent 45%),
          linear-gradient(340deg, rgba(0, 0, 0, 0.4) 0%, transparent 60%);
        pointer-events: none;
      }
      .boot-logo {
        position: relative;
        display: flex;
        align-items: flex-end;
        gap: 18px;
        margin-bottom: 12px;
        z-index: 1;
      }
      .boot-logo img {
        width: clamp(90px, 16vw, 140px);
        height: auto;
        filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.6));
      }
      .boot-logo-text {
        display: flex;
        flex-direction: column;
        line-height: 1;
      }
      .boot-logo-small {
        font-size: clamp(14px, 2vw, 18px);
        letter-spacing: 0.3px;
        opacity: 0.85;
      }
      .boot-logo-large {
        font-size: clamp(28px, 4vw, 44px);
        font-weight: 700;
        letter-spacing: -0.5px;
      }
      .boot-logo-large .boot-logo-xp {
        margin-left: 6px;
        color: #f3a300;
        text-shadow: 0 0 6px rgba(255, 157, 0, 0.6);
      }
      .boot-bar {
        position: relative;
        width: min(320px, 70vw);
        height: 18px;
        border-radius: 4px;
        border: 1px solid #0c3a7a;
        background: linear-gradient(#010811, #031436);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.55), 0 6px 14px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        z-index: 1;
      }
      .boot-bar::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.35);
        pointer-events: none;
      }
      .boot-fill {
        position: absolute;
        top: 3px;
        bottom: 3px;
        left: -45%;
        width: 45%;
        min-width: 120px;
        border-radius: 2px;
        background: repeating-linear-gradient(
          90deg,
          #7bff58 0 22px,
          #3d8f2a 22px 44px
        );
        box-shadow: 0 0 12px rgba(124, 255, 88, 0.55);
        animation: boot-scan var(--bootMs, 1800ms) linear infinite;
      }
      
      .boot-sub {
        font-size: 13px;
        letter-spacing: 0.4px;
        opacity: 0.9;
        z-index: 1;
      }
      .boot-footer {
        font-size: 12px;
        opacity: 0.65;
        letter-spacing: 0.8px;
        margin-top: 24px;
        z-index: 1;
      }
      #clock {
        color: #fff;              /* change to any color you like */
        font-size: 14px;
        text-shadow: 0 1px 0 #000; /* optional XP-style shadow */
        padding: 0 6px;
      }

      @keyframes boot-scan {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(320%);
        }
      }
    </style>
  </head>
  <body>
    <!-- XP Boot Screen -->
    <div id="boot" class="boot-screen">
      <div class="boot-logo" aria-hidden="true">
        <img src="Windows XP.ico" alt="" />
        <div class="boot-logo-text">
          <span class="boot-logo-small">Microsoft</span>
          <span class="boot-logo-large">Windows <span class="boot-logo-xp">XP</span></span>
        </div>
      </div>
      <div class="boot-bar"><div class="boot-fill"></div></div>
      <div class="boot-sub" role="status">Compiling Internships...</div>
      <div class="boot-footer">© Microsoft Corporation</div>
    </div>
    <div class="desktop hidden" id="desktop">
      <!-- Desktop icons (top-to-bottom: bin, explorer, about, projects, extracurriculars, tetris, snake) -->
      <div class="icons" id="iconGrid" aria-label="Desktop">
        <div class="desktop-icon" tabindex="0" data-app="bin">
          <img src="bin.ico" alt="Recycle Bin" />
          <div class="icon-label">Recycle Bin</div>
        </div>

        <div class="desktop-icon" tabindex="0" data-app="explorer">
          <img src="explorer.ico" alt="Explorer Icon" />
          <div class="icon-label">Explorer</div>
        </div>

        <div class="desktop-icon" tabindex="0" data-app="about">
          <img src="My_Computer.ico" alt="About Me" />
          <div class="icon-label">About Me</div>
        </div>

        <div class="desktop-icon" tabindex="0" data-app="projects">
          <img src="folder.ico" alt="Projects Folder" />
          <div class="icon-label">Projects</div>
        </div>

        <div class="desktop-icon" tabindex="0" data-app="extracurriculars">
          <img src="extracurriculars.ico" alt="Extracurriculars" />
          <div class="icon-label">Extracurriculars</div>
        </div>

        <div class="desktop-icon" tabindex="0" data-app="tetris">
          <img src="tetris.ico" alt="Tetris" />
          <div class="icon-label">Tetris</div>
        </div>

        <div class="desktop-icon" tabindex="0" data-app="snake">
          <img src="snake.ico" alt="Snake!" />
          <div class="icon-label">Snake</div>
        </div>
      </div>
      <!-- Sticky: Competitions (Yellow) -->
      <div class="sticky" id="note-edu" data-note-id="edu">
        <div class="sticky-header">Education</div>
        <div class="sticky-body" contenteditable="true">
          <h3>University of Sydney</h3>
          <i>(2023 ~ Present)</i>
          <p>
            <strong>Major: </strong>Financial Mathematics and Statistics<br>
            <strong>Minor: </strong>Anatomy and Histology<br>
            <strong>WAM: </strong>82 (D)<br>
          </p>
          <h4>Relevant Units</h4>
          <ul>
            <li>Financial Derivatives</li>
            <li>Projects in Financial Mathematics</li>
            <li>Stochastic Processes</li>
            <li>Optimization and Financial Mathematics</li>
            <li>Data Analytics</li>
            <li>Probability and Estimation Theory</li>
          </ul>
        </div>
      </div>

        <!-- Sticky: Competitions (Green) -->
      <div class="sticky" id="note-comp" data-note-id="comp">
        <div class="sticky-header">Competitions</div>
        <div class="sticky-body" contenteditable="true">
          <h3>IMC x Allianz Datathon</h3>
          <p><strong>Top 3 Finalist in NSW</strong> <i>(01/09/2025)</i><br>
            Presented our SARIMA/Exp. Smoothing Model that was able to predict 
            number of visitors, temperature, web-scraped price data in the 
            following ski season.</p>
          <h3>Atlassian Datathon</h3>
          <p><strong>Top 6 Finalist in NSW</strong> <i>(16/09/2025)</i><br>
            Presented our Log. Regression/Neural Network Model that was able to 
            show customer retention and expansion to be predicted by various 
            predictors.</p>
        </div>
      </div>

      <!-- Taskbar -->
      <div class="taskbar" id="taskbar" role="toolbar" aria-label="Taskbar">
        <button class="start" id="startBtn" title="Start">
          <img src="Windows XP.ico" alt="Windows Logo" class="win-logo" />
          Start
        </button>

        <div class="quick-launch" id="quickLaunch">
          <!-- Recycle Bin -->
          <div class="ql" title="Recycle Bin" data-app="bin">
            <img src="bin.ico" alt="Bin" />
            <span class="ql-label">Recycle Bin</span>
          </div>

          <!-- Explorer -->
          <div class="ql" title="Explorer" data-app="explorer">
            <img src="explorer.ico" alt="Explorer" />
            <span class="ql-label">Explorer</span>
          </div>

          <!-- Snake Game -->
          <div class="ql" title="Snake" data-app="snake">
            <img src="snake.ico" alt="Snake" />
            <span class="ql-label">Snake</span>
          </div>

          <!-- Tetris Game -->
          <div class="ql" title="Tetris" data-app="tetris">
            <img src="tetris.ico" alt="Tetris" />
            <span class="ql-label">Tetris</span>
          </div>

          <!-- Extracurriculars -->
          <div class="ql" title="Extracurriculars" data-app="extracurriculars">
            <img src="extracurriculars.ico" alt="Extracurriculars" />
            <span class="ql-label">Extracurriculars</span>
          </div>

          <!-- About Me -->
          <div class="ql" title="About Me" data-app="about">
            <img src="My_Computer.ico" alt="About" />
            <span class="ql-label">About Me</span>
          </div>

          <!-- Projects -->
          <div class="ql" title="Projects" data-app="projects">
            <img src="folder.ico" alt="Projects" />
            <span class="ql-label">Projects</span>
          </div>
        </div>
        <div class="tasks" id="taskItems" aria-live="polite"></div>

        <div class="tray">
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="6" fill="#6bcf3c" />
          </svg>
          <div class="clock" id="clock">12:00 PM</div>
        </div>
      </div>
    </div>

    <!-- Window template -->
    <template id="windowTemplate">
      <div class="window" role="dialog" aria-modal="false">
        <div class="titlebar" data-drag-handle>
          <div class="title-left">
            <img class="mini-icon" src="My_Computer.ico" alt="About Me">
            <span class="title-text">About Me</span>
          </div>
          <div class="title-controls">
            <button class="ctl" data-min title="Minimize" aria-label="Minimize">
              <svg viewBox="0 0 24 24"><path d="M6 19h12v-2H6z" /></svg>
            </button>
            <button class="ctl" data-max title="Maximize" aria-label="Maximize">
              <svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z" /></svg>
            </button>
            <button
              class="ctl close"
              data-close
              title="Close"
              aria-label="Close"
            >
              <svg viewBox="0 0 24 24">
                <path
                  d="M18.3 5.71L12 12.01l-6.3-6.3L4.29 7.1l6.3 6.3l-6.3 6.3l1.41 1.41l6.3-6.29l6.3 6.3l1.41-1.41l-6.29-6.3l6.3-6.29z"
                />
              </svg>
            </button>
          </div>
        </div>
        <div class="content">
          <h2>Hey, My name is Sean Wang!</h2>
          <p>
            <strong>Welcome to my resume!</strong> I'm a third year student at
            the University of Sydney, currently studying Bachelor of Science and
            Doctor of Dental Medicine. I major in Financial Maths and Statistics
            and Minor in Anatomy and Histology. Some of my skills include:
          </p>
          <ul>
            <li>Statistical Modelling and Machine Learning</li>
            <li>Financial Time Series analysis</li>
            <li>Python, HTML, CSS, JS</li>
          </ul>
          <p>
            Click on the different applications for more details on what I've done. Any
            questions, feel free to shoot me a message :-)
          </p>
          <p>
            Say hi! ~
            <a
              href="#"
              onclick="alert('seanwang.sydney@gmail.com');return false;"
              >seanwang.sydney@gmail.com</a
            >
          </p>
        </div>
        <div class="status">Ready</div>
      </div>
    </template>

    <audio
      id="bootAudio"
      src="boot.mp3"
      preload="auto"
      aria-hidden="true"
      style="display: none"
    ></audio>

    <script>
      const desktop = document.getElementById("desktop");
      const iconGrid = document.getElementById("iconGrid");
      const taskItems = document.getElementById("taskItems");
      const tpl = document.getElementById("windowTemplate");
      const clock = document.getElementById("clock");
      const extracurricularsPlaylist = [
        {
          id: 'coda',
          title: 'Combined Dentistry Association – President',
          year: '2024 ~ 2025',
          blurb: 'Led a team of executives to organise academic and social events for students of the Double Degree Dentistry Program.',
          media: {
            type: 'image',
            src: 'coda.png',
            alt: 'Combined Dentistry Association Logo',
          },
        },
        {
          id: 'sqt-subcom',
          title: 'Sydney Quant Traders - Subcommittee',
          year: '2024 ~ 2025',
          blurb: 'Organised academic and social events between trading firms and students.',
          media: {
            type: 'image',
            src: 'sqt.jpeg',
            alt: 'SQT Logo',
          },
        },
        {
          id: 'sudata-subcom',
          title: 'Sydney Uni Data Society - Subcommittee',
          year: '2024 ~ 2025',
          blurb: 'Organised social events including coffee chats, cruise and bar crawls.',
          media: {
            type: 'image',
            src: 'sudata.png',
            alt: 'SUDATA Logo',
          },
        },
      ];
      const Z = {
        STICKY_BASE: 200,   // stickies live here
        STICKY_TOP: 399,    // highest a sticky can go
        WINDOW_BASE: 400    // windows start above all stickies
      };

      function clampToDesktop(el) {
        const parent = document.getElementById('desktop').getBoundingClientRect();
        const r = el.getBoundingClientRect();
        const tbH = document.getElementById('taskbar')?.offsetHeight || 40;

        // Get current left/top (fallback to offset)
        let x = parseFloat(el.style.left) || el.offsetLeft;
        let y = parseFloat(el.style.top)  || el.offsetTop;

        // Clamp to keep fully visible
        x = Math.max(0, Math.min(x, parent.width - r.width));
        y = Math.max(0, Math.min(y, parent.height - r.height - tbH));

        el.style.left = x + 'px';
        el.style.top  = y + 'px';
      }

      // Simple list you can extend
      const PROJECTS = [
        {
          id: "p4",
          name: "MC/FD Options Pricer.exe",
          kind: "exe",
          summary: [
            { type: "heading", text: "European Options" },
            {
              type: "paragraph",
              text: "Priced using Monte Carlo methods with variance reduction. Priced using Finite Difference methods including Explicit, Implicit and Crank-Nicolson schemes. Additionally computed Gamma and Deltas using Monte Carlo as well as the implied volatilities with Newton-Raphson Method."
            },
            { type: "heading", text: "Exotic Barrier Options" },
            {
              type: "paragraph",
              text: "Priced using Euler/Milstein method for SDE using Monte Carlo random paths. Priced using Crank-Nicolson scheme by adjusting Derichlet boundaries. Barrier options priced include down and out, up and in, down and in and up and out."
            },
            { type: "heading", text: "American Put" },
            {
              type: "paragraph",
              text: "Priced using Euler/Milstein method for SDE and Longstaff-Schwartz method by estimating continuation value using polynomial regression."
            }
          ],
          tech: ["Python"],
          repo: "https://github.com/swang737/MC-FD-Options-Pricer",
          shot: ""
        },
        {
          id: "p5",
          name: "Backtest Platform.exe",
          kind: "html",
          summary: [
            { type: "heading", text: "DataLoader Module" },
            {
              type: "paragraph",
              text: "Loads prices and allows to quick feature manipulation. Capable to returning log/simple returns, time traversal and individual stock selection."
            },
            { type: "heading", text: "Exploratory Data Anlaysis Module" },
            {
              type: "paragraph",
              text: "Plots prices and returns. Able to verify assumptions of weak stationality in data. Able to calculate and plot individual P/ACF graphs. Fits and backtests SARIMAX models."
            }
          ],
          tech: ["Python"],
          repo: "https://github.com/swang737/Backtesting-Platform",
          shot: ""
        },
        {
          id: "p6",
          name: "Personal Website.html",
          kind: "html",
          summary: [
            { type: "heading", text: "Windows XP Experience" },
            {
              type: "paragraph",
              text: "Recreated a nostalgic Windows XP desktop as an interactive resume with draggable windows, sticky notes, quick launch, and bundled mini games to spotlight work in a memorable way."
            },
            { type: "heading", text: "Polish & Accessibility" },
            {
              type: "paragraph",
              text: "Includes custom boot sequence with audio, keyboard-friendly window management, ARIA-labelled controls, and responsive layouts so the experience holds up on modern browsers."
            }
          ],
          tech: ["HTML", "CSS", "JavaScript"],
          repo: "https://github.com/swang737/swang737.github.io",
          shot: ""
        },
        {
          id: "p7",
          name: "Model-A Site.html",
          kind: "html",
          summary: [
            { type: "heading", text: "Model-A Launch" },
            {
              type: "paragraph",
              text: "Designed a teaser site for the Model-A concept, highlighting features with animated hero sections, layered parallax imagery, and responsive breakpoints tuned for mobile launches." 
            },
            { type: "heading", text: "CMS & Analytics" },
            {
              type: "paragraph",
              text: "Hooked into a lightweight headless CMS for rapid content iteration and wired event tracking to monitor conversions, waitlist signups, and click-through funnels in real time."
            }
          ],
          tech: ["Next.js", "Tailwind", "TypeScript"],
          repo: "https://github.com/swang737/model-a-site",
          shot: ""
        }
      ];

      let snakeGameInstance = null;
      let tetrisGameInstance = null;
      const bootAudioEl = document.getElementById("bootAudio");
      let bootAudioPlayed = false;
      let bootAudioArmed = false;
      let bootAudioFallbackHandler = null;

      function playBootSound() {
        if (bootAudioPlayed || !bootAudioEl) return Promise.resolve();
        try {
          bootAudioEl.currentTime = 0;
        } catch (err) {
          /* ignore seek errors */
        }

        const playPromise = bootAudioEl.play();
        if (!playPromise || typeof playPromise.then !== 'function') {
          bootAudioPlayed = true;
          clearBootSoundFallback();
          return Promise.resolve();
        }

        return playPromise
          .then(() => {
            bootAudioPlayed = true;
            clearBootSoundFallback();
          })
          .catch(() => {
            setupBootSoundFallback();
          });
      }

      function setupBootSoundFallback() {
        if (bootAudioPlayed || bootAudioArmed || !bootAudioEl) return;
        bootAudioArmed = true;
        bootAudioFallbackHandler = () => {
          clearBootSoundFallback();
          playBootSound();
        };
        document.addEventListener('pointerdown', bootAudioFallbackHandler);
        document.addEventListener('keydown', bootAudioFallbackHandler);
      }

      function clearBootSoundFallback() {
        if (!bootAudioFallbackHandler) return;
        document.removeEventListener('pointerdown', bootAudioFallbackHandler);
        document.removeEventListener('keydown', bootAudioFallbackHandler);
        bootAudioFallbackHandler = null;
        bootAudioArmed = false;
      }

      function openApp(app) {
        if (app === "about") return openAboutWindow();
        if (app === "projects") return openProjectsWindow();
        if (app === "explorer") return openExplorerWindow();
        if (app === "snake") return openSnakeWindow();
        if (app === "tetris") return openTetrisWindow();
        if (app === "extracurriculars") return openExtracurricularsWindow();
        if (app === "bin") {
          alert("Recycle Bin is empty.");
          return null;
        }
        alert(`${app} app coming soon`);
        return null;
      }

      document.querySelectorAll(".ql").forEach((btn) => {
        btn.addEventListener("click", () => {
          openApp(btn.dataset.app);
        });
      });

      const quickLaunch = document.getElementById("quickLaunch");

      function qlFor(app) {
        return quickLaunch.querySelector(`.ql[data-app="${app}"]`);
      }

      function activateQuickLaunch(app) {
        const el = qlFor(app);
        if (!el) return;
        // move to rightmost position
        quickLaunch.appendChild(el);
        // expand
        el.classList.add("open", "active");
        // collapse others
        quickLaunch.querySelectorAll(".ql.open").forEach((q) => {
          if (q !== el) q.classList.remove("active");
        });
      }

      function deactivateQuickLaunch(app) {
        const el = qlFor(app);
        if (!el) return;
        el.classList.remove("open", "active", "inactive");
      }

      function markQuickLaunchInactive(app) {
        const el = qlFor(app);
        if (!el) return;
        el.classList.add("inactive");
        el.classList.remove("active");
      }

      function minimizeWindow(win) {
        win.classList.add("hidden");
        if (win._taskBtn) win._taskBtn.classList.add("active");
        const app = win.dataset.app;
        if (app) markQuickLaunchInactive(app);
      }
      function closeWindow(win) {
        if (win._taskBtn) win._taskBtn.remove();
        const app = win.dataset.app;
        if (app === 'snake' && snakeGameInstance) {
          snakeGameInstance.destroy();
          snakeGameInstance = null;
        }
        if (app) deactivateQuickLaunch(app);
        win.remove();
      }
      quickLaunch.addEventListener("click", (e) => {
        const btn = e.target.closest(".ql");
        if (!btn) return;
        const app = btn.dataset.app;
        let win = document.querySelector(`.window[data-app="${app}"]`);

        if (!win) {
          win = openApp(app);
          if (!win) return;
        }

        if (win.classList.contains("hidden")) {
          win.classList.remove("hidden");
          btn.classList.remove("inactive");
          btn.classList.add("active");
        }
        focusWindow(win);
      });

      // Simple clock
      function updateClock() {
        const d = new Date();
        const h = d.getHours();
        const m = d.getMinutes().toString().padStart(2, "0");
        const ampm = h >= 12 ? "PM" : "AM";
        const hh = ((h + 11) % 12) + 1;
        clock.textContent = `${hh}:${m} ${ampm}`;
      }
      updateClock();
      setInterval(updateClock, 30000);

      // === Sticky Notes: drag, focus, and localStorage persistence ===
      (function initStickyNotes(){
        const notes = document.querySelectorAll('.sticky');

        // one counter for all stickies; they live under windows
        let stickyZ = Z.STICKY_BASE; // e.g., 200

        notes.forEach(note => {
          // start behind windows
          note.style.zIndex = Z.STICKY_BASE;

          // drag using the unified helper
          const handle = note.querySelector('.sticky-header');
          if (handle) {
            makeDraggable(note, handle);
          }

          // (optional) simple focus styling on click
          note.addEventListener('mousedown', () => {
            notes.forEach(n => n.classList.remove('active'));
            note.classList.add('active');
          });
        });
      })();

      // === Randomize sticky positions on load ===
      function randomizeStickies(){
        const desktop = document.getElementById('desktop');
        const taskbar  = document.getElementById('taskbar');
        const notes = Array.from(document.querySelectorAll('.sticky'));

        requestAnimationFrame(() => {
          const pad = 16;
          const tbH = taskbar ? taskbar.offsetHeight : 40;
          const deskW = desktop.clientWidth;
          const deskH = desktop.clientHeight;

          notes.forEach((note, i) => {
            const w = note.offsetWidth  || 320;
            const h = note.offsetHeight || 180;
            const maxX = Math.max(pad, deskW - w - pad);
            const maxY = Math.max(pad, deskH - h - tbH - pad);
            const x = Math.min(maxX, Math.max(pad, Math.floor(Math.random()*maxX) + i*24));
            const y = Math.min(maxY, Math.max(pad, Math.floor(Math.random()*maxY) + i*24));
            note.style.left = x + 'px';
            note.style.top  = y + 'px';
            note.style.zIndex = Z.STICKY_BASE; // spawn behind windows
          });
        });
      }

      // Optional: call this to re‑roll a single note’s position later
      function respawnNote(id){
        const desktop = document.getElementById('desktop');
        const taskbar  = document.getElementById('taskbar');
        const note = document.querySelector(`.sticky[data-note-id="${id}"]`);
        if (!note) return;

        const pad = 16;
        const tbH = taskbar ? taskbar.offsetHeight : 40;
        const deskW = desktop.clientWidth;
        const deskH = desktop.clientHeight;
        const w = note.offsetWidth  || 320;
        const h = note.offsetHeight || 180;

        const maxX = Math.max(pad, deskW - w - pad);
        const maxY = Math.max(pad, deskH - h - pad - tbH);

        note.style.left = Math.floor(Math.random() * maxX) + 'px';
        note.style.top  = Math.floor(Math.random() * maxY) + 'px';
      }

      function openAboutWindow() {
        let existing = document.querySelector('.window[data-app="about"]');
        if (existing) {
          focusWindow(existing);
          return existing;
        }
        const win = tpl.content.firstElementChild.cloneNode(true);
        win.dataset.app = "about";
        win.dataset.title = "About Me";
        const vw = window.innerWidth,
          vh = window.innerHeight;
        const x = Math.max(8, Math.min(vw - 420, 90 + Math.random() * 120));
        const y = Math.max(8, Math.min(vh - 320, 90 + Math.random() * 80));
        Object.assign(win.style, { left: x + "px", top: y + "px" });

        // Controls
        win
          .querySelector("[data-close]")
          .addEventListener("click", () => closeWindow(win));
        win
          .querySelector("[data-min]")
          .addEventListener("click", () => minimizeWindow(win));
        win
          .querySelector("[data-max]")
          .addEventListener("click", () => toggleMaximize(win));

        makeDraggable(win, win.querySelector('[data-drag-handle]') || win.querySelector('.titlebar'));

        desktop.appendChild(win);
        activateQuickLaunch("about"); // keep your quick‑launch expansion
        //remove any previously created task button if it exists
        if (win._taskBtn) {
          win._taskBtn.remove();
          win._taskBtn = null;
        }
        focusWindow(win);
        return win;
      }

      function openExplorerWindow() {
        // Don’t open duplicates
        let win = document.querySelector('.window[data-app="explorer"]');
        if (win) {
          if (win.classList.contains("hidden")) win.classList.remove("hidden");
          focusWindow(win);
          return win;
        }

        win = document.createElement("div");
        win.className = "window";
        win.dataset.app = "explorer"; // <-- use lowercase to match quick-launch/data-app
        Object.assign(win.style, {
          left: "160px",
          top: "160px",
          width: "640px",
          height: "460px",
        });

        win.innerHTML = `
        <div class="titlebar" data-drag-handle>
          <div class="title-left">
            <img class="mini-icon" src="explorer.ico" alt="Explorer">
            <span class="title-text">Explorer</span>
          </div>
          <div class="title-controls">
            <button class="ctl" data-min title="Minimize" aria-label="Minimize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 19h12v-2H6z"/>
              </svg>
            </button>
            <button class="ctl" data-max title="Maximize" aria-label="Maximize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 6h12v12H6z"/>
              </svg>
            </button>
            <button class="ctl close" data-close title="Close" aria-label="Close">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M18.3 5.71L12 12.01l-6.3-6.3L4.29 7.1l6.3 6.3l-6.3 6.3l1.41 1.41l6.3-6.29l6.3 6.3l1.41-1.41l-6.29-6.3l6.3-6.29z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="content" style="padding:0; display:flex; flex-direction:column; min-height:0;">
          <iframe
            src="https://en.wikipedia.org/wiki/Main_Page"
            style="width:100%; height:100%; flex:1; border:none;"
            referrerpolicy="no-referrer"
          ></iframe>
        </div>
        <div class="status">Ready</div>
      `;
        desktop.appendChild(win);
        makeDraggable(win, win.querySelector('[data-drag-handle]') || win.querySelector('.titlebar'));

        win
          .querySelector("[data-close]")
          .addEventListener("click", () => closeWindow(win));
        win
          .querySelector("[data-min]")
          .addEventListener("click", () => minimizeWindow(win));
        win
          .querySelector("[data-max]")
          .addEventListener("click", () => toggleMaximize(win));

        focusWindow(win);
        activateQuickLaunch("explorer");
      }
      function iconForKind(kind){
        if (kind === "exe")  return "file-exe.ico";
        if (kind === "html") return "file-html.ico";
        if (kind === "pdf")  return "file-pdf.ico";
        return "file.ico";
      }

      function renderSummary(summary) {
        if (Array.isArray(summary)) {
          return summary
            .map((block) => {
              if (typeof block === "string") {
                return `<p style="margin:6px 0 10px;">${block}</p>`;
              }
              if (!block || typeof block !== "object") return "";
              const text = block.text ?? "";
              if (block.type === "heading") {
                return `<h4 class="project-subhead">${text}</h4>`;
              }
              return `<p style="margin:6px 0 10px;">${text}</p>`;
            })
            .join("");
        }
        if (!summary) return "";
        return `<p style="margin:6px 0 10px;">${summary}</p>`;
      }

      function openSnakeWindow() {
        let win = document.querySelector('.window[data-app="snake"]');
        if (win) {
          if (win.classList.contains('hidden')) win.classList.remove('hidden');
          focusWindow(win);
          activateQuickLaunch('snake');
          return win;
        }

        win = document.createElement('div');
        win.className = 'window';
        win.dataset.app = 'snake';
        Object.assign(win.style, {
          left: '240px',
          top: '160px',
          width: '420px',
          height: '500px',
        });

        win.innerHTML = `
        <div class="titlebar" data-drag-handle>
          <div class="title-left">
            <img class="mini-icon" src="snake.ico" alt="Snake Game">
            <span class="title-text">Snake</span>
          </div>
          <div class="title-controls">
            <button class="ctl" data-min title="Minimize" aria-label="Minimize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 19h12v-2H6z"/>
              </svg>
            </button>
            <button class="ctl" data-max title="Maximize" aria-label="Maximize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 6h12v12H6z"/>
              </svg>
            </button>
            <button class="ctl close" data-close title="Close" aria-label="Close">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M18.3 5.71L12 12.01l-6.3-6.3L4.29 7.1l6.3 6.3l-6.3 6.3l1.41 1.41l6.3-6.29l6.3 6.3l1.41-1.41l-6.29-6.3l6.3-6.29z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="content snake-content">
          <canvas class="snake-canvas" width="320" height="320" aria-label="Snake game board"></canvas>
          <div class="snake-hud">
            <span>Score: <span class="snake-score">0</span></span>
            <button type="button" class="snake-btn snake-restart">Restart</button>
          </div>
          <p class="snake-help">Use arrow keys or WASD to slither. Eat the fruit, avoid the walls and your tail.</p>
        </div>
        <div class="status">Use arrow keys or WASD to play.</div>
      `;

        desktop.appendChild(win);
        makeDraggable(win, win.querySelector('[data-drag-handle]') || win.querySelector('.titlebar'));

        win.querySelector('[data-close]').addEventListener('click', () => closeWindow(win));
        win.querySelector('[data-min]').addEventListener('click', () => minimizeWindow(win));
        win.querySelector('[data-max]').addEventListener('click', () => toggleMaximize(win));

        const canvas = win.querySelector('.snake-canvas');
        const scoreEl = win.querySelector('.snake-score');
        const statusEl = win.querySelector('.status');
        const restartBtn = win.querySelector('.snake-restart');

        if (snakeGameInstance) {
          snakeGameInstance.destroy();
        }
        snakeGameInstance = createSnakeGame({ canvas, scoreEl, statusEl });

        if (restartBtn) {
          restartBtn.addEventListener('click', () => {
            snakeGameInstance?.reset();
            focusWindow(win);
          });
        }

        focusWindow(win);
        activateQuickLaunch('snake');
        return win;
      }

      function openExtracurricularsWindow() {
        let win = document.querySelector('.window[data-app="extracurriculars"]');
        if (win) {
          if (win.classList.contains('hidden')) win.classList.remove('hidden');
          focusWindow(win);
          activateQuickLaunch('extracurriculars');
          return win;
        }

        win = document.createElement('div');
        win.className = 'window';
        win.dataset.app = 'extracurriculars';
        Object.assign(win.style, {
          left: '240px',
          top: '150px',
          width: '720px',
          height: '480px',
        });

        const playlistMarkup = extracurricularsPlaylist
          .map((item, index) => {
            const selected = index === 0;
            const aria = selected ? ' aria-selected="true"' : '';
            return `
              <li class="wmp-track${selected ? ' active' : ''}" data-track="${item.id}" tabindex="0"${aria}>
                <span class="wmp-track-title">${item.title}</span>
                <span class="wmp-track-meta">${item.year ?? ''}</span>
              </li>
            `;
          })
          .join('');

        win.innerHTML = `
        <div class="titlebar" data-drag-handle>
          <div class="title-left">
            <img class="mini-icon" src="extracurriculars.ico" alt="Extracurricular Mix">
            <span class="title-text">Extracurricular Mix</span>
          </div>
          <div class="title-controls">
            <button class="ctl" data-min title="Minimize" aria-label="Minimize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 19h12v-2H6z"/>
              </svg>
            </button>
            <button class="ctl" data-max title="Maximize" aria-label="Maximize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 6h12v12H6z"/>
              </svg>
            </button>
            <button class="ctl close" data-close title="Close" aria-label="Close">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M18.3 5.71L12 12.01l-6.3-6.3L4.29 7.1l6.3 6.3l-6.3 6.3l1.41 1.41l6.3-6.29l6.3 6.3l1.41-1.41l-6.29-6.3l6.3-6.29z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="content" style="padding:0; background:#050b1a; color:#fff; display:flex; flex-direction:column;">
          <div class="wmp-player">
            <aside class="wmp-sidebar">
              <h4>Playlist</h4>
              <ul class="wmp-tracklist" role="listbox">${playlistMarkup}</ul>
            </aside>
            <section class="wmp-main">
              <div class="wmp-display" aria-live="polite"></div>
              <div class="wmp-nowplaying">
                <div class="wmp-controls" role="group" aria-label="Playback controls">
                  <button type="button" class="wmp-btn" data-action="prev" aria-label="Previous experience">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M13 7l-6 5l6 5V7zm6 0h-2v10h2V7z" />
                    </svg>
                  </button>
                  <button type="button" class="wmp-btn wmp-btn-play" data-action="toggle" aria-label="Pause experience">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M8 7h3v10H8zm5 0h3v10h-3z" />
                    </svg>
                  </button>
                  <button type="button" class="wmp-btn" data-action="next" aria-label="Next experience">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path d="M11 7l6 5l-6 5V7zm-6 0h2v10H5V7z" />
                    </svg>
                  </button>
                </div>
                <div class="wmp-now-title">Select an activity</div>
                <div class="wmp-now-meta"></div>
                <p class="wmp-now-blurb">Choose a track from the playlist to see highlights.</p>
              </div>
            </section>
          </div>
        </div>
        <div class="status">Ready</div>
      `;

        desktop.appendChild(win);
        makeDraggable(win, win.querySelector('[data-drag-handle]') || win.querySelector('.titlebar'));

        win.querySelector('[data-close]').addEventListener('click', () => closeWindow(win));
        win.querySelector('[data-min]').addEventListener('click', () => minimizeWindow(win));
        win.querySelector('[data-max]').addEventListener('click', () => toggleMaximize(win));

        const playlistEl = win.querySelector('.wmp-tracklist');
        const displayEl = win.querySelector('.wmp-display');
        const titleEl = win.querySelector('.wmp-now-title');
        const metaEl = win.querySelector('.wmp-now-meta');
        const blurbEl = win.querySelector('.wmp-now-blurb');
        const playBtn = win.querySelector('.wmp-btn[data-action="toggle"]');
        const prevBtn = win.querySelector('.wmp-btn[data-action="prev"]');
        const nextBtn = win.querySelector('.wmp-btn[data-action="next"]');

        if (!playlistEl || !displayEl || !titleEl || !metaEl || !blurbEl) {
          focusWindow(win);
          activateQuickLaunch('extracurriculars');
          return win;
        }

        const idToIndex = new Map(extracurricularsPlaylist.map((item, index) => [item.id, index]));
        let currentIndex = 0;
        let isPlaying = true;

        const playIconSvg = '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5v14l11-7z"/></svg>';
        const pauseIconSvg = '<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 7h3v10H8zm5 0h3v10h-3z"/></svg>';

        function updatePlayButton() {
          if (!playBtn) return;
          playBtn.innerHTML = isPlaying ? pauseIconSvg : playIconSvg;
          playBtn.setAttribute('aria-label', isPlaying ? 'Pause experience' : 'Play experience');
        }

        function currentTrack() {
          return extracurricularsPlaylist[currentIndex] ?? null;
        }

        function updateMeta() {
          const track = currentTrack();
          if (!track) {
            metaEl.textContent = '';
            return;
          }
          const status = isPlaying ? 'Playing' : 'Paused';
          metaEl.textContent = track.year ? `${track.year} • ${status}` : status;
        }

        function updatePlaybackOverlay() {
          if (!displayEl) return;
          displayEl.classList.toggle('paused', !isPlaying);
        }

        function renderTrack(id, { forcePlay = false } = {}) {
          if (!extracurricularsPlaylist.length) {
            displayEl.innerHTML = '<p style="color:#d7e4ff; font-size:14px;">No extracurriculars added yet.</p>';
            titleEl.textContent = 'Coming soon';
            metaEl.textContent = '';
            blurbEl.textContent = '';
            return;
          }

          const track = extracurricularsPlaylist[idToIndex.get(id) ?? currentIndex] ?? extracurricularsPlaylist[0];
          const idx = idToIndex.get(track.id);
          if (typeof idx === 'number') currentIndex = idx;
          if (forcePlay) isPlaying = true;

          playlistEl.querySelectorAll('.wmp-track').forEach((trackEl) => {
            const active = trackEl.dataset.track === track.id;
            trackEl.classList.toggle('active', active);
            if (active) {
              trackEl.setAttribute('aria-selected', 'true');
            } else {
              trackEl.removeAttribute('aria-selected');
            }
            trackEl.tabIndex = active ? 0 : -1;
          });

          displayEl.innerHTML = '';
          if (track.media?.type === 'video' && track.media?.src) {
            const iframe = document.createElement('iframe');
            iframe.src = track.media.src;
            iframe.title = track.media.alt || track.title;
            iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
            iframe.setAttribute('allowfullscreen', 'true');
            displayEl.appendChild(iframe);
          } else if (track.media?.src) {
            const img = document.createElement('img');
            img.src = track.media.src;
            img.alt = track.media.alt || track.title;
            displayEl.appendChild(img);
          } else {
            displayEl.innerHTML = '<p style="color:#d7e4ff; font-size:14px;">No media available.</p>';
          }

          titleEl.textContent = track.title;
          blurbEl.textContent = track.blurb || '';
          updateMeta();
          updatePlayButton();
          updatePlaybackOverlay();
          win.dataset.track = track.id;
        }

        function playRelative(offset) {
          if (!extracurricularsPlaylist.length) return;
          const total = extracurricularsPlaylist.length;
          currentIndex = (currentIndex + offset + total) % total;
          renderTrack(extracurricularsPlaylist[currentIndex].id, { forcePlay: isPlaying });
        }

        playlistEl.addEventListener('click', (event) => {
          const item = event.target.closest('.wmp-track');
          if (!item) return;
          renderTrack(item.dataset.track, { forcePlay: true });
          item.focus();
        });

        playlistEl.addEventListener('keydown', (event) => {
          const { key } = event;
          const items = Array.from(playlistEl.querySelectorAll('.wmp-track'));
          const activeIndex = items.findIndex((el) => el.dataset.track === currentTrack()?.id);
          if (key === 'Enter' || key === ' ') {
            event.preventDefault();
            const focused = document.activeElement?.closest?.('.wmp-track');
            if (focused) {
              renderTrack(focused.dataset.track, { forcePlay: true });
            }
          }
          if (key === 'ArrowDown' || key === 'ArrowUp') {
            event.preventDefault();
            const direction = key === 'ArrowDown' ? 1 : -1;
            const total = items.length;
            if (!total) return;
            const baseIndex = activeIndex >= 0 ? activeIndex : (direction === 1 ? -1 : total);
            let nextIndex = (baseIndex + direction + total) % total;
            if (nextIndex < 0) nextIndex += total;
            items.forEach((el, idx) => {
              el.tabIndex = idx === nextIndex ? 0 : -1;
            });
            items[nextIndex]?.focus();
          }
        });

        prevBtn?.addEventListener('click', () => playRelative(-1));
        nextBtn?.addEventListener('click', () => playRelative(1));
        playBtn?.addEventListener('click', () => {
          isPlaying = !isPlaying;
          updatePlayButton();
          updateMeta();
          updatePlaybackOverlay();
        });

        renderTrack(extracurricularsPlaylist[0]?.id, { forcePlay: true });

        focusWindow(win);
        activateQuickLaunch('extracurriculars');
        return win;
      }

      function openTetrisWindow() {
        let win = document.querySelector('.window[data-app="tetris"]');
        if (win) {
          if (win.classList.contains('hidden')) win.classList.remove('hidden');
          focusWindow(win);
          activateQuickLaunch('tetris');
          return win;
        }

        win = document.createElement('div');
        win.className = 'window';
        win.dataset.app = 'tetris';
        Object.assign(win.style, {
          left: '440px',
          top: '140px',
          width: '560px',
          height: '540px',
        });

        win.innerHTML = `
        <div class="titlebar" data-drag-handle>
          <div class="title-left">
            <img class="mini-icon" src="tetris.ico" alt="Tetris">
            <span class="title-text">Tetris</span>
          </div>
          <div class="title-controls">
            <button class="ctl" data-min title="Minimize" aria-label="Minimize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 19h12v-2H6z"/>
              </svg>
            </button>
            <button class="ctl" data-max title="Maximize" aria-label="Maximize">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 6h12v12H6z"/>
              </svg>
            </button>
            <button class="ctl close" data-close title="Close" aria-label="Close">
              <svg viewBox="0 0 24 24" width="12" height="12">
                <path d="M18.3 5.71L12 12.01l-6.3-6.3L4.29 7.1l6.3 6.3l-6.3 6.3l1.41 1.41l6.3-6.29l6.3 6.3l1.41-1.41l-6.29-6.3l6.3-6.29z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="content tetris-content">
          <div class="tetris-main">
            <canvas class="tetris-canvas" width="240" height="480" aria-label="Tetris playfield"></canvas>
          </div>
          <div class="tetris-sidebar">
            <canvas class="tetris-next" width="120" height="120" aria-label="Next piece preview"></canvas>
            <div class="tetris-stat"><span>Score</span><strong class="tetris-score">0</strong></div>
            <div class="tetris-stat"><span>Lines</span><strong class="tetris-lines">0</strong></div>
            <div class="tetris-stat"><span>Level</span><strong class="tetris-level">1</strong></div>
            <button type="button" class="tetris-btn tetris-restart">Restart</button>
            <p class="tetris-help">Arrow keys move, Z/X rotate, Space hard drop, P pause.</p>
          </div>
        </div>
        <div class="status">Ready to stack! Arrow keys move, space to drop.</div>
      `;

        desktop.appendChild(win);
        makeDraggable(win, win.querySelector('[data-drag-handle]') || win.querySelector('.titlebar'));

        win.querySelector('[data-close]').addEventListener('click', () => closeWindow(win));
        win.querySelector('[data-min]').addEventListener('click', () => minimizeWindow(win));
        win.querySelector('[data-max]').addEventListener('click', () => toggleMaximize(win));

        const canvas = win.querySelector('.tetris-canvas');
        const nextCanvas = win.querySelector('.tetris-next');
        const scoreEl = win.querySelector('.tetris-score');
        const linesEl = win.querySelector('.tetris-lines');
        const levelEl = win.querySelector('.tetris-level');
        const statusEl = win.querySelector('.status');
        const restartBtn = win.querySelector('.tetris-restart');

        if (tetrisGameInstance) {
          tetrisGameInstance.destroy();
        }
        tetrisGameInstance = createTetrisGame({
          canvas,
          nextCanvas,
          scoreEl,
          linesEl,
          levelEl,
          statusEl,
        });

        if (restartBtn) {
          restartBtn.addEventListener('click', () => {
            tetrisGameInstance?.reset();
            focusWindow(win);
          });
        }

        focusWindow(win);
        activateQuickLaunch('tetris');
        return win;
      }

      function createSnakeGame({ canvas, scoreEl, statusEl }) {
        const ctx = canvas?.getContext?.('2d');
        if (!canvas || !ctx) {
          return {
            reset() {},
            destroy() {},
          };
        }

        const gridSize = 20;
        const boardSize = canvas.width;
        const tile = boardSize / gridSize;
        const speed = 110; // ms per step
        const cellPadding = 1;

        let snake = [];
        let direction = { x: 1, y: 0 };
        let queuedDirection = { x: 1, y: 0 };
        let food = { x: 10, y: 10 };
        let score = 0;
        let running = false;
        let frameId = null;
        let lastTick = 0;

        function setStatus(message) {
          if (statusEl) statusEl.textContent = message;
        }

        function setScore(value) {
          score = value;
          if (scoreEl) scoreEl.textContent = value;
        }

        function drawBackground() {
          ctx.fillStyle = '#021004';
          ctx.fillRect(0, 0, boardSize, boardSize);
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.04)';
          ctx.lineWidth = 1;
          for (let i = 1; i < gridSize; i++) {
            ctx.beginPath();
            ctx.moveTo(i * tile, 0);
            ctx.lineTo(i * tile, boardSize);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, i * tile);
            ctx.lineTo(boardSize, i * tile);
            ctx.stroke();
          }
        }

        function drawCell(x, y, color) {
          ctx.fillStyle = color;
          ctx.fillRect(
            x * tile + cellPadding,
            y * tile + cellPadding,
            tile - cellPadding * 2,
            tile - cellPadding * 2
          );
        }

        function spawnFood() {
          let candidate;
          do {
            candidate = {
              x: Math.floor(Math.random() * gridSize),
              y: Math.floor(Math.random() * gridSize),
            };
          } while (snake.some((segment) => segment.x === candidate.x && segment.y === candidate.y));
          return candidate;
        }

        function queueDirection(next) {
          if (next.x === -direction.x && next.y === -direction.y) return;
          queuedDirection = next;
        }

        function advance() {
          const head = {
            x: snake[0].x + direction.x,
            y: snake[0].y + direction.y,
          };

          if (
            head.x < 0 ||
            head.y < 0 ||
            head.x >= gridSize ||
            head.y >= gridSize ||
            snake.some((segment) => segment.x === head.x && segment.y === head.y)
          ) {
            return false;
          }

          snake.unshift(head);

          if (head.x === food.x && head.y === food.y) {
            setScore(score + 1);
            setStatus(`Nice! Score: ${score}`);
            food = spawnFood();
          } else {
            snake.pop();
          }

          return true;
        }

        function draw() {
          drawBackground();
          drawCell(food.x, food.y, '#d62828');
          snake.forEach((segment, index) => {
            drawCell(segment.x, segment.y, index === 0 ? '#8dff5a' : '#35c84a');
          });
        }

        function tick(time) {
          if (!running) return;
          if (!lastTick) lastTick = time;

          if (time - lastTick >= speed) {
            direction = queuedDirection;
            if (!advance()) {
              running = false;
              setStatus(`Game over! Final score: ${score}. Press Restart to play again.`);
              draw();
              frameId = null;
              return;
            }
            lastTick = time;
          }

          draw();
          frameId = requestAnimationFrame(tick);
        }

        function reset() {
          snake = [
            { x: 8, y: 10 },
            { x: 7, y: 10 },
            { x: 6, y: 10 },
          ];
          direction = { x: 1, y: 0 };
          queuedDirection = { x: 1, y: 0 };
          food = spawnFood();
          setScore(0);
          setStatus('Use arrow keys or WASD to play.');
          running = true;
          lastTick = 0;
          draw();
          if (frameId) cancelAnimationFrame(frameId);
          frameId = requestAnimationFrame(tick);
        }

        const handleKeyDown = (event) => {
          let next;
          switch (event.key) {
            case 'ArrowUp':
            case 'w':
            case 'W':
              next = { x: 0, y: -1 };
              break;
            case 'ArrowDown':
            case 's':
            case 'S':
              next = { x: 0, y: 1 };
              break;
            case 'ArrowLeft':
            case 'a':
            case 'A':
              next = { x: -1, y: 0 };
              break;
            case 'ArrowRight':
            case 'd':
            case 'D':
              next = { x: 1, y: 0 };
              break;
            case ' ':
              if (!running) {
                event.preventDefault();
                reset();
              }
              return;
            default:
              return;
          }

          if (next) {
            event.preventDefault();
            queueDirection(next);
          }
        };

        window.addEventListener('keydown', handleKeyDown);
        reset();

        return {
          reset,
          destroy() {
            running = false;
            if (frameId) cancelAnimationFrame(frameId);
            frameId = null;
            window.removeEventListener('keydown', handleKeyDown);
          },
        };
      }

      function createTetrisGame({ canvas, nextCanvas, scoreEl, linesEl, levelEl, statusEl }) {
        const ctx = canvas?.getContext?.('2d');
        if (!canvas || !ctx) {
          return {
            reset() {},
            destroy() {},
          };
        }

        const nextCtx = nextCanvas?.getContext?.('2d') ?? null;
        const COLS = 10;
        const ROWS = 20;
        const CELL = canvas.width / COLS;
        const PIECE_KEYS = ['I', 'J', 'L', 'O', 'S', 'T', 'Z'];
        const SHAPES = {
          I: [
            [0, 0, 0, 0],
            [1, 1, 1, 1],
            [0, 0, 0, 0],
            [0, 0, 0, 0],
          ],
          J: [
            [1, 0, 0],
            [1, 1, 1],
            [0, 0, 0],
          ],
          L: [
            [0, 0, 1],
            [1, 1, 1],
            [0, 0, 0],
          ],
          O: [
            [1, 1],
            [1, 1],
          ],
          S: [
            [0, 1, 1],
            [1, 1, 0],
            [0, 0, 0],
          ],
          T: [
            [0, 1, 0],
            [1, 1, 1],
            [0, 0, 0],
          ],
          Z: [
            [1, 1, 0],
            [0, 1, 1],
            [0, 0, 0],
          ],
        };
        const COLORS = {
          I: '#3ec5ff',
          J: '#3c6df0',
          L: '#ffae42',
          O: '#f9e856',
          S: '#56d86b',
          T: '#b76bff',
          Z: '#ff5c77',
        };
        const LINE_POINTS = [0, 100, 300, 500, 800];

        let board = createMatrix(ROWS, COLS);
        let current = null;
        let position = { x: 0, y: 0 };
        let next = makeRandomPiece();
        let frameId = null;
        let dropCounter = 0;
        let dropInterval = 1000;
        let lastTime = 0;
        let score = 0;
        let lines = 0;
        let level = 1;
        let paused = false;
        let gameOver = false;
        let disposed = false;

        function createMatrix(rows, cols) {
          return Array.from({ length: rows }, () => Array(cols).fill(0));
        }

        function cloneMatrix(matrix) {
          return matrix.map((row) => row.slice());
        }

        function makeRandomPiece() {
          const key = PIECE_KEYS[Math.floor(Math.random() * PIECE_KEYS.length)];
          return {
            name: key,
            matrix: cloneMatrix(SHAPES[key]),
          };
        }

        function setStatus(message) {
          if (statusEl) statusEl.textContent = message;
        }

        function updateDashboard() {
          if (scoreEl) scoreEl.textContent = String(score);
          if (linesEl) linesEl.textContent = String(lines);
          if (levelEl) levelEl.textContent = String(level);
        }

        function drawBlock(context, gridX, gridY, size, color, originX = 0, originY = 0) {
          const x = originX + gridX * size;
          const y = originY + gridY * size;
          context.fillStyle = color;
          context.fillRect(x, y, size, size);
          context.fillStyle = 'rgba(255,255,255,0.12)';
          context.fillRect(x, y, size, size * 0.3);
          context.strokeStyle = 'rgba(0,0,0,0.35)';
          context.lineWidth = 1;
          context.strokeRect(x + 0.5, y + 0.5, size - 1, size - 1);
        }

        function drawMatrix(matrix, offset, name, context = ctx, size = CELL, originX = 0, originY = 0) {
          matrix.forEach((row, y) => {
            row.forEach((value, x) => {
              if (!value) return;
              const drawX = offset.x + x;
              const drawY = offset.y + y;
              if (context === ctx && drawY < 0) return;
              drawBlock(context, drawX, drawY, size, COLORS[name] || '#fff', originX, originY);
            });
          });
        }

        function drawGrid() {
          ctx.strokeStyle = 'rgba(255,255,255,0.05)';
          ctx.lineWidth = 1;
          for (let x = 1; x < COLS; x++) {
            ctx.beginPath();
            ctx.moveTo(x * CELL, 0);
            ctx.lineTo(x * CELL, canvas.height);
            ctx.stroke();
          }
          for (let y = 1; y < ROWS; y++) {
            ctx.beginPath();
            ctx.moveTo(0, y * CELL);
            ctx.lineTo(canvas.width, y * CELL);
            ctx.stroke();
          }
        }

        function draw() {
          ctx.fillStyle = '#050d21';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          drawGrid();
          board.forEach((row, y) => {
            row.forEach((cell, x) => {
              if (!cell) return;
              drawBlock(ctx, x, y, CELL, COLORS[cell] || '#fff');
            });
          });
          if (current) {
            drawMatrix(current.matrix, position, current.name);
          }
        }

        function drawNextPreview() {
          if (!nextCtx || !next) return;
          nextCtx.fillStyle = '#050d21';
          nextCtx.fillRect(0, 0, nextCanvas.width, nextCanvas.height);
          const size = next.matrix.length;
          let minX = size;
          let minY = size;
          let maxX = 0;
          let maxY = 0;
          next.matrix.forEach((row, y) => {
            row.forEach((value, x) => {
              if (!value) return;
              if (x < minX) minX = x;
              if (y < minY) minY = y;
              if (x > maxX) maxX = x;
              if (y > maxY) maxY = y;
            });
          });
          const pieceWidth = maxX - minX + 1;
          const pieceHeight = maxY - minY + 1;
          const cellSize = Math.min(
            Math.floor(nextCanvas.width / (pieceWidth + 2)),
            Math.floor(nextCanvas.height / (pieceHeight + 2))
          );
          const offsetX = Math.floor((nextCanvas.width - pieceWidth * cellSize) / 2);
          const offsetY = Math.floor((nextCanvas.height - pieceHeight * cellSize) / 2);
          drawMatrix(next.matrix, { x: -minX, y: -minY }, next.name, nextCtx, cellSize, offsetX, offsetY);
        }

        function collidesAt(pos, matrix) {
          for (let y = 0; y < matrix.length; y++) {
            for (let x = 0; x < matrix[y].length; x++) {
              if (!matrix[y][x]) continue;
              const nx = pos.x + x;
              const ny = pos.y + y;
              if (nx < 0 || nx >= COLS || ny >= ROWS) return true;
              if (ny >= 0 && board[ny][nx]) return true;
            }
          }
          return false;
        }

        function mergePiece() {
          current.matrix.forEach((row, y) => {
            row.forEach((value, x) => {
              if (!value) return;
              const ny = position.y + y;
              if (ny < 0) return;
              board[ny][position.x + x] = current.name;
            });
          });
        }

        function clearLines() {
          let cleared = 0;
          for (let y = ROWS - 1; y >= 0; y--) {
            if (board[y].every(Boolean)) {
              board.splice(y, 1);
              board.unshift(Array(COLS).fill(0));
              cleared++;
              y++;
            }
          }
          return cleared;
        }

        function rotateMatrix(matrix, dir) {
          const size = matrix.length;
          const result = Array.from({ length: size }, () => Array(size).fill(0));
          for (let y = 0; y < size; y++) {
            for (let x = 0; x < size; x++) {
              if (dir > 0) {
                result[x][size - 1 - y] = matrix[y][x];
              } else {
                result[size - 1 - x][y] = matrix[y][x];
              }
            }
          }
          return result;
        }

        function tryRotate(dir) {
          if (!current || paused || gameOver) return;
          const rotated = rotateMatrix(current.matrix, dir);
          const offsets = [0, -1, 1, -2, 2];
          const originalX = position.x;
          for (const offset of offsets) {
            const nextPos = { x: originalX + offset, y: position.y };
            if (!collidesAt(nextPos, rotated)) {
              position.x = nextPos.x;
              current.matrix = rotated;
              return;
            }
          }
        }

        function updateLevel(clearedLines) {
          if (!clearedLines) return;
          const gained = LINE_POINTS[clearedLines] || LINE_POINTS[LINE_POINTS.length - 1] * 1.2;
          score += Math.floor(gained * level);
          lines += clearedLines;
          level = Math.floor(lines / 10) + 1;
          dropInterval = Math.max(120, 1000 - (level - 1) * 80);
        }

        function lockPiece() {
          mergePiece();
          const cleared = clearLines();
          if (cleared) {
            updateLevel(cleared);
            setStatus(`Cleared ${cleared} line${cleared > 1 ? 's' : ''}!`);
          } else {
            setStatus('Keep stacking!');
          }
          updateDashboard();
          spawnPiece();
        }

        function spawnPiece() {
          current = next;
          position = {
            x: Math.floor(COLS / 2) - Math.ceil(current.matrix[0].length / 2),
            y: -1,
          };
          next = makeRandomPiece();
          drawNextPreview();
          if (collidesAt(position, current.matrix)) {
            current = null;
            gameOver = true;
            setStatus('Game over! Press Restart or Space to play again.');
            updateDashboard();
          }
        }

        function move(dir) {
          if (paused || gameOver || !current) return;
          const nextPos = { x: position.x + dir, y: position.y };
          if (!collidesAt(nextPos, current.matrix)) {
            position.x = nextPos.x;
          }
        }

        function softDrop(fromInput = false) {
          if (paused || gameOver || !current) return;
          const nextPos = { x: position.x, y: position.y + 1 };
          if (collidesAt(nextPos, current.matrix)) {
            lockPiece();
            dropCounter = 0;
            return;
          }
          position.y = nextPos.y;
          dropCounter = 0;
          if (fromInput) {
            score += 1;
            updateDashboard();
          }
        }

        function hardDrop() {
          if (paused || gameOver || !current) return;
          let distance = 0;
          while (!collidesAt({ x: position.x, y: position.y + 1 }, current.matrix)) {
            position.y += 1;
            distance += 1;
          }
          if (distance) {
            score += distance * 2;
          }
          lockPiece();
          updateDashboard();
        }

        function togglePause() {
          if (gameOver) return;
          paused = !paused;
          setStatus(paused ? 'Paused. Press P to resume.' : 'Resumed! Keep stacking.');
        }

        function update(time) {
          if (disposed) return;
          if (!lastTime) lastTime = time;
          const delta = time - lastTime;
          lastTime = time;

          if (!paused && !gameOver) {
            dropCounter += delta;
            if (dropCounter >= dropInterval) {
              softDrop();
            }
          }

          draw();
          frameId = requestAnimationFrame(update);
        }

        function reset() {
          board = createMatrix(ROWS, COLS);
          current = null;
          position = { x: 0, y: 0 };
          next = makeRandomPiece();
          score = 0;
          lines = 0;
          level = 1;
          dropInterval = 1000;
          dropCounter = 0;
          lastTime = 0;
          paused = false;
          gameOver = false;
          disposed = false;
          updateDashboard();
          spawnPiece();
          draw();
          if (frameId) cancelAnimationFrame(frameId);
          frameId = requestAnimationFrame(update);
          setStatus('Ready! Arrow keys move, space hard drops, P pauses.');
        }

        const handleKeyDown = (event) => {
          const { key } = event;
          const win = document.querySelector('.window[data-app="tetris"]');
          if (!win || win.classList.contains('hidden')) return;

          switch (key) {
            case 'ArrowLeft':
            case 'a':
            case 'A':
              event.preventDefault();
              move(-1);
              break;
            case 'ArrowRight':
            case 'd':
            case 'D':
              event.preventDefault();
              move(1);
              break;
            case 'ArrowDown':
            case 's':
            case 'S':
              event.preventDefault();
              softDrop(true);
              break;
            case 'ArrowUp':
            case 'w':
            case 'W':
            case 'x':
            case 'X':
              event.preventDefault();
              tryRotate(1);
              break;
            case 'z':
            case 'Z':
              event.preventDefault();
              tryRotate(-1);
              break;
            case ' ': {
              event.preventDefault();
              if (gameOver) {
                reset();
              } else {
                hardDrop();
              }
              break;
            }
            case 'Enter':
            case 'r':
            case 'R':
              if (gameOver) {
                event.preventDefault();
                reset();
              }
              break;
            case 'p':
            case 'P':
              event.preventDefault();
              togglePause();
              break;
            default:
              break;
          }
        };

        window.addEventListener('keydown', handleKeyDown);
        reset();

        return {
          reset,
          destroy() {
            disposed = true;
            if (frameId) cancelAnimationFrame(frameId);
            frameId = null;
            window.removeEventListener('keydown', handleKeyDown);
          },
        };
      }

      function openProjectsWindow() {
        let win = document.querySelector('.window[data-app="projects"]');
        if (win) { if (win.classList.contains('hidden')) win.classList.remove('hidden'); focusWindow(win); return win; }

        win = document.createElement('div');
        win.className = 'window';
        win.dataset.app = 'projects';
        Object.assign(win.style, { left:'220px', top:'140px', width:'760px', height:'520px' });

        const listHTML = PROJECTS.map(p => `
          <div class="file-item" data-pid="${p.id}" tabindex="0">
            <img class="ficon" src="${iconForKind(p.kind)}" alt="">
            <div class="meta">
              <div class="name">${p.name}</div>
              <div class="sub">${p.tech.join(", ")}</div>
            </div>
          </div>
        `).join('');

        win.innerHTML = `
          <div class="titlebar" data-drag-handle>
            <div class="title-left">
              <img class="mini-icon" src="folder.ico" alt="Projects">
              <span class="title-text">Projects</span>
            </div>
            <div class="title-controls">
              <button class="ctl" data-min title="Minimize" aria-label="Minimize">
                <svg viewBox="0 0 24 24" width="12" height="12">
                  <path d="M6 19h12v-2H6z"/>
                </svg>
              </button>
              <button class="ctl" data-max title="Maximize" aria-label="Maximize">
                <svg viewBox="0 0 24 24" width="12" height="12">
                  <path d="M6 6h12v12H6z"/>
                </svg>
              </button>
              <button class="ctl close" data-close title="Close" aria-label="Close">
                <svg viewBox="0 0 24 24" width="12" height="12">
                  <path d="M18.3 5.71L12 12.01l-6.3-6.3L4.29 7.1l6.3 6.3l-6.3 6.3l1.41 1.41l6.3-6.29l6.3 6.3l1.41-1.41l-6.29-6.3l6.3-6.29z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="content" style="padding:0; display:flex; flex-direction:column; min-height:0;">
            <div style="padding:6px 10px; border-bottom:1px solid #cbd5f0; background:#eef3ff;">
              <strong>My Projects</strong> — double‑click a file to open
            </div>
            <div class="file-list" id="projectList">${listHTML}</div>
         </div>
          <div class="status">Ready</div>
        `;

        desktop.appendChild(win);
        makeDraggable(win, win.querySelector('[data-drag-handle]') || win.querySelector('.titlebar'));
        win.querySelector('[data-close]').addEventListener('click', () => closeWindow(win));
        win.querySelector('[data-min]').addEventListener('click', () => minimizeWindow(win));
        win.querySelector('[data-max]').addEventListener('click', () => toggleMaximize(win));
        focusWindow(win);
        if (typeof activateQuickLaunch === 'function') activateQuickLaunch('projects');

        // selection + open behavior
        const list = win.querySelector('#projectList');
        let sel;
        list.addEventListener('click', e => {
          const item = e.target.closest('.file-item'); if (!item) return;
          if (sel) sel.classList.remove('selected');
          sel = item; sel.classList.add('selected');
        });
        list.addEventListener('dblclick', e => {
          const item = e.target.closest('.file-item'); if (!item) return;
          const pid = item.dataset.pid;
          const p = PROJECTS.find(x => x.id === pid);
          if (p) openProjectDetails(p);
        });

        return win;
      }

      function openProjectDetails(p) {
        // one window per project
        let win = document.querySelector(`.window[data-app="proj-${p.id}"]`);
        if (win) { if (win.classList.contains('hidden')) win.classList.remove('hidden'); focusWindow(win); return; }

        win = document.createElement('div');
        win.className = 'window';
        win.dataset.app = `proj-${p.id}`;
        Object.assign(win.style, { left:'260px', top:'180px', width:'560px', height:'420px' });

        const repoButton = p.repo
          ? `<a class="project-repo-btn" href="${p.repo}" target="_blank" rel="noopener noreferrer">View on GitHub</a>`
          : '';

        win.innerHTML = `
          <div class="titlebar" data-drag-handle>
            <div class="title-left">
              <img class="mini-icon" src="${iconForKind(p.kind)}" alt="">
              <span class="title-text">${p.name.replace(/\.[a-z0-9]+$/i,'')}</span>
            </div>
            <div class="title-controls">
              <button class="ctl" data-min title="Minimize" aria-label="Minimize">
                <svg viewBox="0 0 24 24" width="12" height="12">
                  <path d="M6 19h12v-2H6z"/>
                </svg>
              </button>
              <button class="ctl" data-max title="Maximize" aria-label="Maximize">
                <svg viewBox="0 0 24 24" width="12" height="12">
                  <path d="M6 6h12v12H6z"/>
                </svg>
              </button>
              <button class="ctl close" data-close title="Close" aria-label="Close">
                <svg viewBox="0 0 24 24" width="12" height="12">
                  <path d="M18.3 5.71L12 12.01l-6.3-6.3L4.29 7.1l6.3 6.3l-6.3 6.3l1.41 1.41l6.3-6.29l6.3 6.3l1.41-1.41l-6.29-6.3l6.3-6.29z"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="content" style="padding:12px; overflow:auto;">
            ${p.shot ? `<img src="${p.shot}" alt="" style="max-width:100%; border:1px solid #ddd; border-radius:6px; margin-bottom:10px;">` : ''}
            <h3 style="margin:6px 0 8px;">${p.name}</h3>
            ${renderSummary(p.summary)}
            <p style="margin:6px 0;"><strong>Tech:</strong> ${p.tech.join(", ")}</p>
            ${repoButton ? `<div class="project-actions">${repoButton}</div>` : ''}
          </div>
          <div class="status">Ready</div>
  `     ;
        desktop.appendChild(win);
        makeDraggable(win, win.querySelector('[data-drag-handle]') || win.querySelector('.titlebar'));
        win.querySelector('[data-close]').addEventListener('click', () => closeWindow(win));
        win.querySelector('[data-min]').addEventListener('click', () => minimizeWindow(win));
        win.querySelector('[data-max]').addEventListener('click', () => toggleMaximize(win));
        focusWindow(win);
        return win;
      }

      let zCounter = Z.WINDOW_BASE;
      function focusWindow(win) {
        // Deactivate all other windows
        document.querySelectorAll(".window").forEach(w => w.classList.add("inactive"));

        // Bring selected window to front
        win.classList.remove("inactive");
        win.style.zIndex = ++zCounter;

        // Highlight taskbar + quick-launch button
        const app = win.dataset.app;
        document.querySelectorAll(".task[data-app]").forEach(task => {
          task.classList.toggle("active", task.dataset.app === app);
        });
        document.querySelectorAll(".ql[data-app]").forEach(ql => {
          ql.classList.toggle("active", ql.dataset.app === app);
        });
      }

      function minimizeWindow(win) {
        win.classList.add("hidden");
        if (win._taskBtn) win._taskBtn.classList.add("active");
        const app = win.dataset.app;
        if (app) {
          const el = document.querySelector(
            `#quickLaunch .ql[data-app="${app}"]`
          );
          if (el) {
            el.classList.add("inactive");
            el.classList.remove("active");
          }
        }
      }

      function closeWindow(win) {
        if (win._taskBtn) win._taskBtn.remove();
        const app = win.dataset.app;
        if (app) {
          if (app === 'snake' && snakeGameInstance) {
            snakeGameInstance.destroy();
            snakeGameInstance = null;
          }
          if (app === 'tetris' && tetrisGameInstance) {
            tetrisGameInstance.destroy();
            tetrisGameInstance = null;
          }
          const el = document.querySelector(
            `#quickLaunch .ql[data-app="${app}"]`
          );
          if (el) el.classList.remove("open", "active", "inactive"); // ← collapse back to icon
        }
        win.remove();
      }

      function toggleMaximize(win) {
        if (!win._restore) {
          const r = win.getBoundingClientRect();
          win._restore = {
            left: r.left,
            top: r.top,
            width: r.width,
            height: r.height,
          };
          Object.assign(win.style, {
            left: "8px",
            top: "8px",
            width: window.innerWidth - 16 + "px",
            height: window.innerHeight - 56 + "px",
          });
        } else {
          const { left, top, width, height } = win._restore;
          delete win._restore;
          Object.assign(win.style, {
            left: left + "px",
            top: top + "px",
            width: width + "px",
            height: height + "px",
          });
        }
        focusWindow(win);
      }

      function makeDraggable(el, handle) {
        let dragging = false, sx=0, sy=0, sl=0, st=0;

        // Stop page scroll while touching the handle
        handle.style.touchAction = 'none';

        // Helper: get current numeric left/top in the same coord space we will write to
        function currentPos() {
          const cs = getComputedStyle(el);
          const l = parseFloat(cs.left);
          const t = parseFloat(cs.top);
          return {
            left: Number.isNaN(l) ? el.offsetLeft : l,
            top:  Number.isNaN(t) ? el.offsetTop  : t
          };
        }

        function down(e){
          // If mouse: only left button
          if (e.pointerType === 'mouse' && e.button !== 0) return;

          // Ensure we don’t have any leftover transforms
          el.style.transform = '';

          const pos = currentPos();
          sl = pos.left;  st = pos.top;
          sx = e.clientX; sy = e.clientY;

          dragging = true;
          el.setPointerCapture?.(e.pointerId);
          e.preventDefault?.(); // helps Safari stop text selection
        }

  function move(e){
    if (!dragging) return;
    const nx = sl + (e.clientX - sx);
    const ny = st + (e.clientY - sy);
    el.style.left = nx + 'px';
    el.style.top  = ny + 'px';
  }

  function up(e){
    if (!dragging) return;
    dragging = false;
    el.releasePointerCapture?.(e.pointerId);
    clampToDesktop(el);
  }

  handle.addEventListener('pointerdown', down, { passive:false });
  window.addEventListener('pointermove', move, { passive:true });
  window.addEventListener('pointerup',   up,   { passive:true });
}

      /* ===================== ICONS: vertical order + drag & snap ===================== */
      const ICON_W = 96,
        ICON_H = 96,
        ICON_GAP = 8,
        ICON_MARGIN = 12;
      const ICON_ORDER = ["bin", "explorer", "about", "projects", "extracurriculars", "tetris", "snake"]; // top-to-bottom
      const ICON_LAYOUT_VERSION = "20241007"; // unused when persistence disabled

      function setIconPosition(el, left, top) {
        el.style.left = left + "px";
        el.style.top = top + "px";
      }
      function saveIconPosition() {}
      function restoreIconPosition() { return false; }
      function snap(n, size) {
        return Math.round(n / (size + ICON_GAP)) * (size + ICON_GAP);
      }

      function makeIconDraggable(el) {
        let sx = 0,
          sy = 0,
          sl = 0,
          st = 0,
          dragging = false;
        const down = (e) => {
          if (e.button !== 0) return;
          dragging = true;
          sx = e.clientX;
          sy = e.clientY;
          sl = el.offsetLeft;
          st = el.offsetTop;
          document.addEventListener("mousemove", move);
          document.addEventListener("mouseup", up);
        };
        const move = (e) => {
          if (!dragging) return;
          let nx = sl + (e.clientX - sx);
          let ny = st + (e.clientY - sy);
          const bounds = iconGrid.getBoundingClientRect();
          const maxX = bounds.width - ICON_W - ICON_MARGIN;
          const maxY = bounds.height - ICON_H - ICON_MARGIN;
          nx = Math.min(Math.max(ICON_MARGIN, nx), Math.max(ICON_MARGIN, maxX));
          ny = Math.min(Math.max(ICON_MARGIN, ny), Math.max(ICON_MARGIN, maxY));
          setIconPosition(el, nx, ny);
        };
        const up = () => {
          if (!dragging) return;
          dragging = false;
          // Snap to grid
          const nx = ICON_MARGIN + snap(el.offsetLeft - ICON_MARGIN, ICON_W);
          const ny = ICON_MARGIN + snap(el.offsetTop - ICON_MARGIN, ICON_H);
          setIconPosition(el, nx, ny);
          saveIconPosition(el);
          document.removeEventListener("mousemove", move);
          document.removeEventListener("mouseup", up);
        };
        el.addEventListener("mousedown", down);
      }

      function resetIconPositionsIfNeeded() {}

      function layoutIconsVertically() {
        resetIconPositionsIfNeeded();
        ICON_ORDER.forEach((app, i) => {
          const el = document.querySelector(`.desktop-icon[data-app="${app}"]`);
          if (!el) return;
          if (!restoreIconPosition(el)) {
            const left = ICON_MARGIN;
            const top = ICON_MARGIN + i * (ICON_H + ICON_GAP);
            setIconPosition(el, left, top);
          }
          makeIconDraggable(el);
        });
      }

      // Desktop interactions
      iconGrid.addEventListener("click", (e) => {
        const icon = e.target.closest(".desktop-icon");
        if (!icon) return;
        document
          .querySelectorAll(".desktop-icon")
          .forEach((i) => i.classList.remove("selected"));
        icon.classList.add("selected");
      });
      iconGrid.addEventListener("dblclick", (e) => {
        const icon = e.target.closest(".desktop-icon");
        if (!icon) return;
        openApp(icon.dataset.app);
      });

      // Keyboard open (Enter/Space)
      document.addEventListener("keydown", (e) => {
        if (
          (e.key === "Enter" || e.key === " ") &&
          document.activeElement?.classList.contains("desktop-icon")
        ) {
          openApp(document.activeElement.dataset.app);
        }
        if (e.key === "Escape") {
          const top = [...document.querySelectorAll(".window")].sort(
            (a, b) => (+b.style.zIndex || 0) - (+a.style.zIndex || 0)
          )[0];
          if (top) closeWindow(top);
        }
      });

      // Init
      window.addEventListener("load", () => {
        const boot = document.getElementById("boot");
        const fill = boot?.querySelector?.(".boot-fill");
        const bootMs = 3000;

        if (fill) {
          fill.style.animationDuration = `1200ms`;
          fill.style.setProperty('--bootMs', '1200ms');
        }

        if (bootAudioEl) {
          bootAudioEl.volume = 0.75;
        }

        setTimeout(() => {
          boot?.classList.add("hidden");
          document.getElementById("desktop")?.classList.remove("hidden");
          updateClock();
          layoutIconsVertically();
          randomizeStickies();
          setTimeout(openAboutWindow, 300);
          playBootSound().catch(() => setupBootSoundFallback());
        }, bootMs);
      });
    </script>
  </body>
</html>
